<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI-–ê–Ω–∞–ª—ñ–∑–∞—Ç–æ—Ä (–¢–µ—Ö–Ω–æ–≥—ñ–∫)</title>
    <style>
        :root { --bg: #0a0c10; --panel: #14171c; --olive: #8fbc55; --text: #e5e7eb; --border: #2a2e35; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; font-size: 16px; }
        
        .nav-back { display: inline-block; color: var(--olive); text-decoration: none; font-size: 1.2em; font-weight: bold; margin-bottom: 25px; padding: 5px 0; }
        
        .api-box { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin-bottom: 20px; }
        .api-input-group { display: flex; gap: 10px; margin-top: 8px; }
        .api-input-group input { flex-grow: 1; padding: 10px; border-radius: 8px; background: #000; color: #fff; border: 1px solid var(--olive); outline: none; }
        .api-input-group button { padding: 10px 15px; background: var(--border); color: #fff; border: 1px solid var(--olive); border-radius: 8px; cursor: pointer; }

        .header { text-align: center; margin-bottom: 25px; }
        .header h2 { margin: 0; color: var(--olive); }
        .header p { color: #aaa; font-size: 0.95em; line-height: 1.4; }

        .input-card { background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        .upload-btns { display: flex; gap: 10px; margin-bottom: 15px; }
        .u-btn { flex: 1; padding: 12px; background: #1c2128; color: #fff; border: 1px solid var(--olive); border-radius: 10px; text-align: center; cursor: pointer; font-size: 0.9em; font-weight: bold; transition: 0.2s; }
        .u-btn:active { background: #2a313c; }
        .u-btn input { display: none; }
        
        #preview-container { display: none; margin-bottom: 15px; position: relative; }
        #preview-img { width: 100%; border-radius: 10px; border: 1px solid var(--olive); }
        .remove-img { position: absolute; top: 10px; right: 10px; background: rgba(255,0,0,0.8); color: #fff; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-weight: bold; font-size: 18px; }

        textarea { width: 100%; height: 100px; background: #000; color: #fff; border: 1px solid var(--olive); border-radius: 10px; padding: 12px; box-sizing: border-box; outline: none; font-size: 16px; margin-bottom: 10px; resize: none; }
        textarea:focus { border-color: var(--olive); box-shadow: 0 0 5px rgba(143, 188, 85, 0.3); }

        .hint-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .hint-tag { background: #1c2128; border: 1px solid var(--olive); color: #e5e7eb; padding: 8px 14px; border-radius: 20px; font-size: 0.85em; cursor: pointer; transition: all 0.2s ease; user-select: none; }
        .hint-tag:active { background: var(--olive); color: #000; transform: scale(0.95); }

        .btn-main { width: 100%; padding: 16px; background: linear-gradient(180deg, #9ac95c 0%, #759c44 100%); color: #0a0c10; border: 1px solid #5a7a33; border-radius: 10px; font-weight: 900; font-size: 1.1em; cursor: pointer; box-shadow: inset 0 2px 3px rgba(255,255,255,0.4), inset 0 -3px 5px rgba(0,0,0,0.2), 0 6px 15px rgba(0,0,0,0.5); transition: all 0.15s ease; }
        .btn-main:active { box-shadow: inset 0 4px 8px rgba(0,0,0,0.5); transform: translateY(3px); }

        #chat { margin-top: 25px; }
        .msg { padding: 15px; border-radius: 12px; margin-bottom: 15px; line-height: 1.5; }
        .msg.ai { background: var(--panel); border: 1px solid var(--border); border-left: 4px solid var(--olive); }
        .msg.user { background: #1c2128; border: 1px solid var(--olive); color: #fff; text-align: right; }
        
        .loader { display: none; text-align: center; color: var(--olive); font-weight: bold; padding: 20px; }
    </style>
</head>
<body>

    <a href="ai_hub.html" class="nav-back">‚¨Ö –ù–∞–∑–∞–¥</a>

    <div class="api-box">
        <label style="font-size: 0.8em; color: #888;">üîë Gemini API Key:</label>
        <div class="api-input-group">
            <input type="password" id="gemini-key" placeholder="–í—Å—Ç–∞–≤—Ç–µ –∫–ª—é—á...">
            <button onclick="saveKey()">OK</button>
        </div>
    </div>

    <div class="header">
        <h2>üõí AI-–ê–Ω–∞–ª—ñ–∑–∞—Ç–æ—Ä</h2>
        <p>–Ø –¥–æ–ø–æ–º–æ–∂—É –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏ —Ç–æ–≤–∞—Ä–∏, –∑–Ω–∞–π—Ç–∏ –∫—Ä–∞—â—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–∞ –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ —ñ–¥–µ–∞–ª—å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ –∞–±–æ –Ω–∞–ø–∏—à—ñ—Ç—å –∑–∞–ø–∏—Ç–∞–Ω–Ω—è.</p>
    </div>

    <div class="input-card">
        <div class="upload-btns">
            <label class="u-btn">üì∑ –ö–∞–º–µ—Ä–∞ <input type="file" accept="image/*" capture="environment" onchange="preview(this)"></label>
            <label class="u-btn">üìÅ –ì–∞–ª–µ—Ä–µ—è <input type="file" accept="image/*" onchange="preview(this)"></label>
        </div>

        <div id="preview-container">
            <button class="remove-img" onclick="removePreview()">√ó</button>
            <img id="preview-img" src="">
        </div>

        <textarea id="user-text" placeholder="–û–ø–∏—à—ñ—Ç—å, —â–æ –≤–∏ —à—É–∫–∞—î—Ç–µ, –∞–±–æ –æ–±–µ—Ä—ñ—Ç—å —à–≤–∏–¥–∫–µ –ø–∏—Ç–∞–Ω–Ω—è –Ω–∏–∂—á–µ..."></textarea>
        
        <div class="hint-tags">
            <span class="hint-tag" onclick="useHint(this)">–ü–æ—Ä—ñ–≤–Ω—è–π —Ü–µ –∑ –º–æ–¥–µ–ª–ª—é –º–∏–Ω—É–ª–æ–≥–æ —Ä–æ–∫—É</span>
            <span class="hint-tag" onclick="useHint(this)">–ó–Ω–∞–π–¥–∏ —Ç–∞–∫–µ —Å–∞–º–µ, –∞–ª–µ –¥–µ—à–µ–≤—à–µ</span>
            <span class="hint-tag" onclick="useHint(this)">–Ø–∫—ñ –≥–æ–ª–æ–≤–Ω—ñ –ø–µ—Ä–µ–≤–∞–≥–∏ —Ü—å–æ–≥–æ —Ç–æ–≤–∞—Ä—É?</span>
            <span class="hint-tag" onclick="useHint(this)">–ß–∏ –ø—ñ–¥—ñ–π–¥–µ —Ü–µ –¥–ª—è —ñ–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è?</span>
        </div>
        
        <button class="btn-main" onclick="startAnalysis()">üîç –†–û–ó–ü–û–ß–ê–¢–ò –ê–ù–ê–õ–Ü–ó</button>
    </div>

    <div class="loader" id="loader">‚è≥ –¢–µ—Ö–Ω–æ–≥—ñ–∫ –∞–Ω–∞–ª—ñ–∑—É—î –¥–∞–Ω—ñ...</div>
    <div id="chat"></div>

    <script>
        let selectedBase64 = null;
        let chatHistory = [];
        const PROMPT = "–¢–∏ - –¢–µ—Ö–Ω–æ–≥—ñ–∫, –µ–∫—Å–ø–µ—Ä—Ç –∑ –∞–Ω–∞–ª—ñ–∑—É —Ç–æ–≤–∞—Ä—ñ–≤. –¢–≤–æ—è –º–µ—Ç–∞: –¥–æ–ø–æ–º–æ–≥—Ç–∏ –ø–æ–∫—É–ø—Ü–µ–≤—ñ –∑—Ä–æ–±–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π —Ñ–æ—Ç–æ (—è–∫—â–æ —î) —Ç–∞ —Ç–µ–∫—Å—Ç –∑–∞–ø–∏—Ç—É. –ü–æ—Ä—ñ–≤–Ω—é–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –≤–∫–∞–∑—É–π –Ω–∞ –ø–ª—é—Å–∏ —Ç–∞ –º—ñ–Ω—É—Å–∏, —à—É–∫–∞–π –Ω–∞–π–∫—Ä–∞—â—ñ —Ä—ñ—à–µ–Ω–Ω—è. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ, –∞–ª–µ –∑—Ä–æ–∑—É–º—ñ–ª–æ—é –º–æ–≤–æ—é. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –µ–º–æ–¥–∑—ñ. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é.";

        document.addEventListener("DOMContentLoaded", () => {
            const savedKey = localStorage.getItem("ai_pilot_gemini_key");
            if (savedKey) document.getElementById("gemini-key").value = savedKey;
        });

        function saveKey() {
            localStorage.setItem("ai_pilot_gemini_key", document.getElementById("gemini-key").value.trim());
            alert("‚úÖ –ö–ª—é—á –∑–±–µ—Ä–µ–∂–µ–Ω–æ");
        }

        function useHint(element) {
            document.getElementById("user-text").value = element.innerText;
        }

        function preview(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    selectedBase64 = e.target.result.split(",")[1];
                    document.getElementById("preview-img").src = e.target.result;
                    document.getElementById("preview-container").style.display = "block";
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function removePreview() {
            selectedBase64 = null;
            document.getElementById("preview-container").style.display = "none";
        }

        async function startAnalysis() {
            const key = localStorage.getItem("ai_pilot_gemini_key");
            const text = document.getElementById("user-text").value.trim();
            if (!key) return alert("–í—Å—Ç–∞–≤—Ç–µ API –∫–ª—é—á!");
            if (!text && !selectedBase64) return alert("–î–æ–¥–∞–π—Ç–µ —Ñ–æ—Ç–æ –∞–±–æ –Ω–∞–ø–∏—à—ñ—Ç—å –ø–∏—Ç–∞–Ω–Ω—è!");

            addMsg(text || "–ê–Ω–∞–ª—ñ–∑ –ø–æ —Ñ–æ—Ç–æ", "user");
            document.getElementById("loader").style.display = "block";
            
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;
            
            let contents = [];
            if (selectedBase64) {
                contents = [{ role: "user", parts: [{ text: text || "–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π —Ü–µ–π —Ç–æ–≤–∞—Ä" }, { inline_data: { mime_type: "image/jpeg", data: selectedBase64 } }] }];
                chatHistory = [...contents];
            } else {
                chatHistory.push({ role: "user", parts: [{ text: text }] });
                contents = chatHistory;
            }

            try {
                const resp = await fetch(url, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ contents: contents }) });
                const data = await resp.json();
                document.getElementById("loader").style.display = "none";

                if (data.candidates) {
                    const aiText = data.candidates[0].content.parts[0].text;
                    addMsg(aiText.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>'), "ai");
                    chatHistory.push({ role: "model", parts: [{ text: aiText }] });
                    removePreview();
                    document.getElementById("user-text").value = "";
                }
            } catch (e) { document.getElementById("loader").style.display = "none"; alert("–ü–æ–º–∏–ª–∫–∞ –∑–≤'—è–∑–∫—É –∑ –Ü–Ü"); }
        }

        function addMsg(t, s) {
            const div = document.createElement("div");
            div.className = "msg " + s;
            div.innerHTML = t;
            document.getElementById("chat").prepend(div);
            window.scrollTo(0, document.body.scrollHeight);
        }
    </script>
</body>
</html>
